# Marketplace Manager â€“ Project Documentation

## Quick Links
- **Roadmap**: [roadmap.md](./roadmap.md) â€“ Quarterly phases and deliverables
- **Plan**: [plan.md](./plan.md) â€“ Detailed implementation scope and workstreams
- **Milestones**: [milestones.md](./milestones.md) â€“ Weekly milestones and deliverables
- **Blueprint**: [marketplace-blueprint.md](./marketplace-blueprint.md) â€“ Complete architecture and code reference
- **Requirements**: [requirements.md](./requirements.md) â€“ Functional and non-functional expectations
- **Design Spec**: [design-spec.md](./design-spec.md) â€“ Architecture, data flows, and testing strategy
- **Implementation Checklist**: [implementation-checklist.md](./implementation-checklist.md) â€“ Build/QA/release gates

---

## ğŸ“± Project Overview

**Marketplace Manager** is a unified Swift/SwiftUI application that enables sellers to manage product listings, orders, and earnings across multiple marketplace platforms (eBay, Mercari, Facebook Marketplace) from a single dashboard.

### Core Goals
âœ… One-click multi-platform listing publishing  
âœ… Aggregated orders dashboard with real-time sync  
âœ… Earnings tracking with per-platform breakdown  
âœ… Secure OAuth2 authentication and token management  
âœ… Offline-first architecture with reliable sync  

---

## ğŸ—ï¸ Architecture at a Glance

```
SwiftUI Views (Inventory, Orders, Earnings, Settings)
    â†“
Service Layer (ListingService, OrderAggregatorService, EarningsService, AuthManager)
    â†“
API Layer (eBayAPIClient, MercariAPIClient, FacebookAPIClient)
    â†“
Marketplace APIs + Local Persistence (Core Data, Keychain)
```

**Key Principles:**
- **Service-Oriented**: Each platform isolated, testable, replaceable
- **Reactive**: Real-time updates via Combine framework
- **Offline-First**: Local caching with background sync every 5 minutes
- **Secure**: Tokens stored encrypted in Keychain, OAuth2 token refresh built-in
- **Error Resilient**: Graceful fallbacks, retry logic, user-friendly messages

---

## ğŸ“‚ Project Structure

```
MarketplaceApp/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ Product.swift                    # Local inventory item
â”‚   â”œâ”€â”€ PlatformListing.swift            # Platform-specific metadata
â”‚   â”œâ”€â”€ Order.swift                      # Aggregated order from any platform
â”‚   â”œâ”€â”€ PlatformAccount.swift            # OAuth credentials
â”‚   â””â”€â”€ Earnings.swift                   # Analytics and calculations
â”‚
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ APIClient.swift                  # Base networking (token refresh, errors)
â”‚   â”œâ”€â”€ AuthenticationManager.swift      # OAuth2 lifecycle
â”‚   â”œâ”€â”€ ListingService.swift             # Product CRUD + multi-platform publish
â”‚   â”œâ”€â”€ OrderAggregatorService.swift     # Fetch/sync orders from all platforms
â”‚   â”œâ”€â”€ EarningsService.swift            # Calculate analytics
â”‚   â”œâ”€â”€ PersistenceManager.swift         # Core Data wrapper
â”‚   â””â”€â”€ KeychainManager.swift            # Secure token storage
â”‚
â”œâ”€â”€ APIClients/
â”‚   â”œâ”€â”€ EBayAPIClient.swift              # eBay REST integration
â”‚   â”œâ”€â”€ MercariAPIClient.swift           # Mercari integration
â”‚   â””â”€â”€ FacebookAPIClient.swift          # Facebook Graph API integration
â”‚
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ ContentView.swift                # Tab navigation root
â”‚   â”œâ”€â”€ InventoryView.swift              # Browse/create/manage products
â”‚   â”œâ”€â”€ OrdersView.swift                 # Aggregated orders dashboard
â”‚   â”œâ”€â”€ OrderDetailView.swift            # Order status and tracking
â”‚   â”œâ”€â”€ EarningsView.swift               # Analytics and platform breakdown
â”‚   â”œâ”€â”€ SettingsView.swift               # Account management and OAuth flow
â”‚   â””â”€â”€ Components/                      # Reusable UI components
â”‚
â””â”€â”€ Utilities/
    â”œâ”€â”€ Constants.swift                  # API keys, endpoints, defaults
    â”œâ”€â”€ Logging.swift                    # Telemetry and diagnostics
    â””â”€â”€ Extensions.swift                 # Helper methods
```

---

## ğŸš€ Getting Started

### Prerequisites
- **Xcode 15+** with Swift 5.9+
- **iOS 15+** / **macOS 12+** (universal app)
- **eBay Developer Account** (sandbox access for testing)
- **Mercari API credentials** (if using Mercari)
- **Facebook App** with Marketplace permissions (if using Facebook)

### Setup Steps

1. **Clone and open project**
   ```bash
   git clone <repo>
   cd MarketplaceApp
   open MarketplaceApp.xcodeproj
   ```

2. **Configure API credentials**
   - Add to `Constants.swift`:
     ```swift
     struct APIConstants {
         static let eBayAppId = "YOUR_EBAY_APP_ID"
         static let eBayCertId = "YOUR_EBAY_CERT_ID"
         static let mercariApiKey = "YOUR_MERCARI_API_KEY"
         static let facebookAppId = "YOUR_FACEBOOK_APP_ID"
     }
     ```

3. **Set up OAuth redirect schemes**
   - In `Info.plist`, register URL schemes for each platform:
     ```xml
     <key>CFBundleURLTypes</key>
     <array>
         <dict>
             <key>CFBundleURLName</key>
             <string>eBay OAuth</string>
             <key>CFBundleURLSchemes</key>
             <array>
                 <string>marketplaceapp.ebay</string>
             </array>
         </dict>
     </array>
     ```

4. **Build and run**
   ```bash
   xcode build
   xcode run
   ```

---

## ğŸ“‹ Phase Breakdown

### **Phase 1: Foundation (Week 1â€“2)**
Models, API client infrastructure, Keychain setup, basic UI skeleton.  
â†’ See [roadmap.md](./roadmap.md) for details.

### **Phase 2: Auth & Persistence (Week 3â€“4)**
OAuth2 flows, Core Data wiring, token management.

### **Phase 3: eBay Integration (Week 5â€“7)**
Full end-to-end: list item â†’ appears on eBay â†’ fetch orders â†’ calculate earnings.

### **Phase 4: Multi-Platform (Week 8â€“11)**
Mercari, Facebook, and unified publish flow.

### **Phase 5: Dashboards & Polish (Week 12â€“14)**
Earnings analytics, sync reliability, error handling, logging.

### **Phase 6: Beta & Feedback (Week 15â€“16)**
TestFlight, uncle feedback, v2 planning.

See [milestones.md](./milestones.md) for weekly breakdowns.

---

## ğŸ”‘ Core Workflows

### 1. Create and Publish a Listing
```
User fills CreateListingView (title, price, images)
    â†“
Selects platforms (eBay, Mercari, Facebook checkboxes)
    â†“
ListingService.publishToAllPlatforms() kicks off concurrent tasks
    â†“
Each platform's APIClient (eBayAPIClient, etc.) makes API calls
    â†“
Platform listing IDs stored in Core Data
    â†“
PlatformListings appear in InventoryView with platform badges
```

### 2. Fetch Orders (Every 5 Minutes)
```
OrderAggregatorService starts periodic sync timer on init
    â†“
Timer fires â†’ fetchOrdersFromAllPlatforms() called
    â†“
Concurrent calls to eBayAPIClient.fetchOrders(), etc.
    â†“
All orders merged, saved to Core Data
    â†“
Orders published via @Published var, OrdersView refreshes
```

### 3. View Earnings
```
User selects date range in EarningsView (This Week, This Month, etc.)
    â†“
EarningsService.calculateEarnings(for: period) reads Order records
    â†“
Groups orders by platform, calculates fees, net earnings
    â†“
Populates earningsSummary with platform breakdown
    â†“
UI displays summary cards + platform breakdown table
```

---

## ğŸ” Security Highlights

| Layer | Strategy |
|-------|----------|
| **Token Storage** | Keychain (encrypted, iOS system-managed) |
| **Token Refresh** | Automatic before expiration; 401 auto-retries |
| **API Communication** | HTTPS + SSL certificate pinning (optional) |
| **User Data** | Core Data only on device; no cloud sync (v1) |
| **OAuth Flow** | ASWebAuthenticationSession for native browser flow |

---

## ğŸ§ª Testing

### Unit Tests
```swift
// Test APIClient token refresh
// Test ListingService publish logic
// Test EarningsService calculations
// Test Keychain token storage/retrieval
```

### Integration Tests
```swift
// Test full flow: create listing â†’ publish â†’ fetch orders â†’ calculate earnings
// Test multi-platform sync concurrency
// Test Core Data persistence layer
```

### Manual Testing Checklist
- [ ] Create product and publish to â‰¥2 platforms
- [ ] Orders sync automatically every 5 minutes
- [ ] Earnings dashboard shows correct totals and fee breakdown
- [ ] Token refresh works silently (no manual re-login)
- [ ] App works offline; syncs when reconnected
- [ ] Settings page connects/disconnects accounts cleanly

---

## ğŸ“Š Sync & Reliability

### Sync Strategy
- **Orders**: Background timer every 5 minutes (configurable)
- **Listings**: On-demand when user publishes; stats sync on schedule
- **Earnings**: Calculated on-demand when user opens tab

### Error Handling
- **Rate Limit (429)**: Exponential backoff + user toast notification
- **401 Unauthorized**: Automatic token refresh + 1 retry
- **Network Error**: Queue for retry; show offline badge
- **API Timeout**: 30-second timeout; user can manually retry

### Offline Support
- Listings and orders cached locally in Core Data
- User can view cached data without network
- Changes queue for sync when reconnected

---

## ğŸ› ï¸ Development Workflow

### Branch Strategy
```
main (production releases)
â”œâ”€â”€ develop (integration branch)
    â”œâ”€â”€ feature/ebay-integration
    â”œâ”€â”€ feature/earnings-dashboard
    â”œâ”€â”€ feature/offline-support
    â””â”€â”€ bugfix/token-refresh-edge-case
```

### Code Review Checklist
- [ ] Follows Swift conventions and design patterns
- [ ] No hardcoded secrets; uses Constants.swift or environment vars
- [ ] Error handling for all API calls
- [ ] No force unwraps without guard statements
- [ ] Unit tests added for new services
- [ ] Documentation updated for public APIs

### Deployment to TestFlight
```bash
# Increment build number
xcrun agvtool next-version -all

# Archive and upload
xcodebuild -scheme MarketplaceApp -configuration Release archive
xcodebuild -exportArchive -archivePath ... -exportOptionsPlist ...

# Distribute via App Store Connect
```

---

## ğŸ“š Key Files & Quick Reference

| File | Purpose |
|------|---------|
| `Models/Product.swift` | Local listing data structure |
| `Services/ListingService.swift` | CRUD + multi-platform publish |
| `Services/OrderAggregatorService.swift` | Sync orders from all platforms |
| `Services/EarningsService.swift` | Analytics calculations |
| `APIClients/EBayAPIClient.swift` | eBay REST integration example |
| `Views/InventoryView.swift` | Main inventory browsing UI |
| `Views/OrdersView.swift` | Orders dashboard with filters |
| `Views/EarningsView.swift` | Earnings analytics & breakdown |

---

## ğŸ¯ Success Criteria

**Minimum Viable Product (MVP):**
- [ ] Create and publish listing to â‰¥2 platforms in one flow
- [ ] Orders synced and displayed with correct totals
- [ ] Earnings accurate to within 1% of platform totals
- [ ] No manual token refresh required (auto-refresh works)
- [ ] App gracefully handles network failures

**v1.1 Enhancements:**
- [ ] Shipping label generation integration
- [ ] Inventory alerts (low stock, expiring listings)
- [ ] Bulk publish/edit workflows
- [ ] Advanced filtering and search

**v2.0 Vision:**
- [ ] Repricing rules and automation
- [ ] Team multi-user access
- [ ] Advanced reporting and tax summaries
- [ ] Mobile app (iOS/iPadOS optimized)

---

## ğŸ“‹ Operational Playbook (New)

- **Platform Readiness**: OAuth sandbox credentials validated for eBay, Mercari, Facebook; redirects verified on device.
- **Sync Reliability**: Background timer enabled; retries logged with jitter; platform health surfaced in Settings.
- **Supportability**: Structured logs with correlation IDs; audit trail for publish attempts and order imports.
- **Quality Gates**: Unit + UI smoke tests run per platform, accessibility check for primary flows, localization keys verified.

---

## ğŸ”— External Resources

- **eBay API Docs**: https://developer.ebay.com/docs
- **Mercari API**: https://mercari.com/developers
- **Facebook Graph API**: https://developers.facebook.com/docs/graph-api
- **Swift Concurrency**: https://developer.apple.com/swift/concurrency/
- **Core Data**: https://developer.apple.com/documentation/coredata

---

## ğŸ“ Documentation Files

- **[roadmap.md](./roadmap.md)** â€“ Quarterly timeline, phases, owner
- **[plan.md](./plan.md)** â€“ Scope, deliverables, workstreams, risks
- **[milestones.md](./milestones.md)** â€“ Weekly milestones and acceptance criteria
- **[marketplace-blueprint.md](./marketplace-blueprint.md)** â€“ Full code architecture

---

## ğŸ¤ Contributing

1. Fork the repository
2. Create feature branch: `git checkout -b feature/your-feature`
3. Commit changes: `git commit -am 'Add feature'`
4. Push to branch: `git push origin feature/your-feature`
5. Open pull request with description

---

## ğŸ“§ Contact & Support

**Project Lead**: <your-name>  
**Email**: <your-email>  
**Status**: ğŸŸ¢ In Active Development (Phase 1â€“2)

---

## ğŸ“„ License

MIT License. See LICENSE file for details.

---

**Last Updated**: December 1, 2025  
**Version**: 1.0.0 (Planning Phase)
